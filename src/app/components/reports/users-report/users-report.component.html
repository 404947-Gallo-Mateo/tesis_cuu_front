<app-users-dashboard></app-users-dashboard>

<div class="container-fluid p-4">

  <h2 class="mb-4 fw-semibold">Reporte de Usuarios</h2>

  <!-- Sección de Filtros -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-light">
      <h5 class="mb-0">Filtros de Búsqueda</h5>
    </div>
    <div class="card-body">
      <div class="row g-3">
        <!-- Filtro por Email -->
        <div class="col-md-2">
          <label class="form-label">Email</label>
          <input type="text" class="form-control" 
                 [(ngModel)]="emailFilter" 
                 placeholder="Buscar por email">
        </div>
        
        <!-- Filtro por Nombre Completo -->
        <div class="col-md-2">
          <label class="form-label">Nombre Completo</label>
          <input type="text" class="form-control" 
                 [(ngModel)]="nameFilter" 
                 placeholder="Buscar por nombre">
        </div>
        
        <!-- Filtro por Edad -->
        <div class="col-md-2">
          <label class="form-label">Edad</label>
          <div class="row g-2">
            <div class="col">
              <input type="number" class="form-control" 
                     placeholder="Desde" min="0"
                     [(ngModel)]="minAge">
            </div>
            <div class="col">
              <input type="number" class="form-control" 
                     placeholder="Hasta" min="0"
                     [(ngModel)]="maxAge">
            </div>
          </div>
        </div>                
        
        <!-- Filtro por Género -->
        <div class="col-md-3">
          <label class="form-label">Género</label>
          <div class="border rounded p-2 bg-light">
            <div class="d-flex flex-wrap gap-3">
              @for (genre of genres; track genre.value) {
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" 
                         [id]="'genre-'+genre.value"
                         [checked]="selectedGenres().includes(genre.value)"
                         (change)="toggleGenre(genre.value)">
                  <label class="form-check-label" [for]="'genre-'+genre.value">
                    {{ genre.label }}
                  </label>
                </div>
              }
            </div>
          </div>
        </div>

        <!-- Filtro por Roles -->
        <div class="col-md-3">
          <label class="form-label">Roles</label>
          <div class="border rounded p-2 bg-light">
            <div class="d-flex flex-wrap gap-3">
              @for (role of roles; track role.value) {
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" 
                         [id]="'role-'+role.value"
                         [checked]="selectedRoles().includes(role.value)"
                         (change)="toggleRole(role.value)">
                  <label class="form-check-label" [for]="'role-'+role.value">
                    {{ role.label }}
                  </label>
                </div>
              }
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </div>

  <!-- Resto del código (tabla, paginación, etc.) -->
  <!-- Loading -->
  @if (loading()) {
    <div class="text-center my-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p>Cargando usuarios...</p>
    </div>
  }

  <!-- Error -->
  @if (error()) {
    <div class="alert alert-danger">
      {{ error() }}
    </div>
  }

  <!-- Tabla de usuarios -->
  @if (!loading() && users().length > 0) {
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Edad</th>
            <th>Género</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of filteredUsers() | paginate: { 
            itemsPerPage: itemsPerPage(), 
            currentPage: currentPage(),
            totalItems: totalItems() 
          }">
            <td>{{ user.firstName }} {{ user.lastName }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.role | role }}</td>
            <td>{{ user.birthDate | age }}</td>
            <td>{{ user.genre | genre }}</td>        
          </tr>
        </tbody>
      </table>

      <!-- Paginación -->
      <div class="d-flex justify-content-between align-items-center mt-3">
        <div>
          Mostrando {{ (currentPage() - 1) * itemsPerPage() + 1 }} a 
          {{ Math.min(currentPage() * itemsPerPage(), totalItems()) }} 
          de {{ totalItems() }} usuarios
        </div>
        
        <pagination-controls
          previousLabel="Anterior"
          nextLabel="Siguiente"
          (pageChange)="currentPage.set($event)"
          [responsive]="true"
          [maxSize]="5"
          class="my-pagination">
        </pagination-controls>
      </div>
    </div>
  }

  <!-- Sin resultados -->
  @if (!loading() && users().length === 0) {
    <div class="alert alert-info">
      No se encontraron usuarios registrados.
    </div>
  }
</div>

